<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Produk Warung Emung</title>
<style>
body { font-family: Arial; margin:15px; background:#fafafa; color:#333; }
h2{text-align:center;margin-bottom:20px;}
.form-container,.output-container{background:white;padding:12px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:15px;}
input,select,textarea{padding:8px;margin:5px 0;width:100%;border:1px solid #ccc;border-radius:6px;}
button{padding:9px 12px;margin:4px 3px;border:none;border-radius:8px;cursor:pointer;color:white;font-weight:bold;}
.add-btn{background:#4CAF50;}
.generate-btn{background:#2196F3;}
.copy-btn{background:#FF9800;}
.upload-btn{background:#9C27B0;}
.backup-btn{background:#795548;}
.table-wrapper{overflow-x:auto;}
table{width:100%;border-collapse:collapse;margin-top:8px;min-width:480px;}
th,td{border:1px solid #ddd;padding:6px;text-align:center;font-size:14px;}
th{background:#f3f3f3;}
td button{background:#f44336;color:white;border:none;padding:5px 10px;border-radius:6px;cursor:pointer;}
pre{background:#111;color:#0f0;padding:10px;border-radius:8px;overflow-x:auto;white-space:pre-wrap;font-size:13px;}
</style>
</head>
<body>

<h2>üõí Admin Produk Warung Emung</h2>

<div class="form-container">
<label>Nama Produk</label>
<input type="text" id="name" placeholder="Contoh: Sosis Bakar Mba Atin">
<label>Harga (Rp)</label>
<input type="number" id="price" placeholder="Contoh: 5000">
<label>Kategori</label>
<input type="text" id="category" placeholder="Contoh: makanan">
<label>Nama Gambar (jpg/png)</label>
<input type="text" id="imageName" placeholder="Contoh: sosis.jpg">
<button class="add-btn" onclick="addProduct()">+ Tambah Produk</button>
</div>

<div class="form-container">
<label>Input JSON untuk Tambah Produk (array JS)</label>
<textarea id="jsonInput" rows="6" placeholder="Paste JSON di sini..."></textarea>
<button class="add-btn" onclick="addProductsFromJSON()">+ Tambah dari JSON</button>
</div>

<div class="form-container table-wrapper">
<table id="productTable">
<thead>
<tr><th>No</th><th>Nama</th><th>Harga</th><th>Kategori</th><th>Gambar</th><th>Aksi</th></tr>
</thead>
<tbody></tbody>
</table>
</div>

<div class="form-container">
<label>GitHub Token</label>
<input type="text" id="githubToken" placeholder="Masukkan token di sini">
<button class="upload-btn" onclick="uploadToGitHub()">üöÄ Upload ke GitHub</button>
<button class="backup-btn" onclick="downloadJSON()">‚¨áÔ∏è Backup JSON Lokal</button>
</div>

<div class="output-container">
<button class="generate-btn" onclick="generateJSON()">üíæ Generate Format JS</button>
<button class="copy-btn" onclick="copyJSON()">üìã Copy</button>
<h3>Hasil Generate:</h3>
<pre id="jsonOutput">[ Kosong ]</pre>
</div>

<script>
let products = JSON.parse(localStorage.getItem('products') || '[]');
const tableBody = document.querySelector('#productTable tbody');
const jsonOutput = document.getElementById('jsonOutput');

function saveLocal(){ localStorage.setItem('products', JSON.stringify(products)); }
function renderTable(){
  tableBody.innerHTML = '';
  products.forEach((p,i)=>{
    tableBody.innerHTML += `<tr>
<td>${i+1}</td><td>${p.name}</td><td>${p.price}</td><td>${p.category}</td><td>${p.img}</td>
<td><button onclick="deleteProduct(${i})">Hapus</button></td></tr>`;
  });
}

function addProduct(){
  const name=document.getElementById('name').value.trim();
  const price=document.getElementById('price').value.trim();
  const category=document.getElementById('category').value.trim();
  const imageName=document.getElementById('imageName').value.trim();
  if(!name||!price||!category||!imageName){alert('‚ö†Ô∏è Semua kolom harus diisi!');return;}
  const img=`images/${imageName}`;
  products.push({name,price:Number(price),img,category});
  saveLocal(); renderTable();
  document.getElementById('name').value='';
  document.getElementById('price').value='';
  document.getElementById('category').value='';
  document.getElementById('imageName').value='';
}

function addProductsFromJSON(){
  const jsonText = document.getElementById('jsonInput').value.trim();
  if(!jsonText){ alert('‚ö†Ô∏è JSON kosong!'); return; }
  try{
    const arr = JSON.parse(jsonText.replace(/'/g,'"')); // ubah kutip tunggal jadi ganda
    if(!Array.isArray(arr)){ alert('‚ö†Ô∏è Format harus array!'); return; }
    arr.forEach(p=>{
      if(p.name && p.price && p.category && p.img){
        products.push({name:p.name,price:Number(p.price),img:p.img,category:p.category});
      }
    });
    saveLocal(); renderTable();
    document.getElementById('jsonInput').value='';
    alert('‚úÖ Produk berhasil ditambahkan dari JSON!');
  }catch(e){ alert('‚ùå JSON tidak valid! '+e); }
}

function deleteProduct(index){ products.splice(index,1); saveLocal(); renderTable(); }

function generateJSON(){
  if(products.length===0){ jsonOutput.textContent='[ Kosong ]'; return; }
  let jsArray='[\n';
  products.forEach((p,i)=>{
    jsArray += ` {name:'${p.name}',price:${p.price},img:'${p.img}',category:'${p.category}'}${i<products.length-1?',':''}\n`;
  });
  jsArray += '];';
  jsonOutput.textContent = jsArray;
}

function copyJSON(){ navigator.clipboard.writeText(jsonOutput.textContent).then(()=>alert('‚úÖ Disalin ke clipboard!')).catch(()=>alert('‚ùå Gagal menyalin.')); }

function downloadJSON(){
  const blob = new Blob([JSON.stringify(products,null,2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='products.json'; a.click();
  URL.revokeObjectURL(url);
}

async function uploadToGitHub(){
  const token = document.getElementById('githubToken').value.trim();
  if(!token){ alert('Masukkan token!'); return; }

  const GITHUB_USERNAME = 'warungemung26';
  const GITHUB_REPO = 'WarungEmung';
  const FILE_PATH = 'products.json';
  const GITHUB_BRANCH = 'main';
  const content = btoa(JSON.stringify(products,null,2));

  try{
    let sha;
    let check = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${FILE_PATH}`,{
      headers:{'Authorization':`token ${token}`}
    });
    let checkData = await check.json();
    if(checkData.sha) sha = checkData.sha;

    const res = await fetch(`https://api.github.com/repos/${GITHUB_USERNAME}/${GITHUB_REPO}/contents/${FILE_PATH}`,{
      method:'PUT',
      headers:{'Authorization':`token ${token}`,'Content-Type':'application/json'},
      body:JSON.stringify({
        message:"Update products via admin latihan",
        content: content,
        sha: sha,
        branch:GITHUB_BRANCH
      })
    });
    const result = await res.json();
    if(result.content) alert('‚úÖ JSON berhasil diupload! Cek repo-mu.');
    else alert('‚ùå Upload gagal: '+JSON.stringify(result));
  }catch(e){ console.error(e); alert('‚ùå Gagal upload: '+e); }
}

renderTable();
</script>

</body>
</html>
